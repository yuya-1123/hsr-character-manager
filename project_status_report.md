# 崩壊スターレイル キャラクター管理アプリ - 開発状況レポート

## プロジェクト概要

崩壊スターレイルのキャラクター情報管理・戦闘シミュレーションを統合したReactアプリケーション。ゲームプレイ中にサブモニターで参照でき、個人の所持状況と最適化提案、さらに**キャストリス新蕾システム**などの特殊戦闘システムのシミュレーション機能を提供する実用ツール。

## 技術スタック

- **フロントエンド**: React 18.2.0 + JavaScript → TypeScript移行予定
- **開発環境**: VSCode + npm + GitHub Desktop + Claude連携
- **デプロイ**: GitHub Pages（開発と並行）
- **スタイリング**: CSS Modules（コンポーネント別）
- **状態管理**: React Hooks + Context API（将来）
- **戦闘システム**: プラグイン型アーキテクチャ + イベント駆動設計 🆕
- **データ管理**: JavaScriptオブジェクト + ローカルストレージ

## 🎉 最新実装完了（2025/09/11）

### ✅ 戦闘システム基盤の完全実装
- **プラグイン型アーキテクチャ**: 新しい特殊システムを既存コードを壊さず追加可能
- **イベント駆動システム**: HP変化・EP獲得・召喚物管理を統合
- **キャストリス新蕾システム**: 味方HP減少→新蕾チャージ→死竜召喚の完全実装
- **拡張可能設計**: 黄泉の残夢、飛霄の真龍など今後のシステム対応準備完了

### ✅ メニューシステムとUI分離
- **左サイドメニュー**: ゲームUI風デザインで直感的操作
- **キャラクター図鑑**: 既存機能を独立コンポーネント化
- **戦闘シミュレーション**: 段階的実装（新蕾デモ→フル機能）
- **将来拡張枠**: 素材計算、アチーブメント攻略などの準備

### ✅ キャラクターデータ大幅拡張
新規追加キャラクター（HoYoWiki検証済み基礎ステータス）：
- **ヒアンシー** (風/記憶/★5): HP1086, ATK388, DEF630, SPD110
- **トリビー** (量子/調和/★5): HP1048, ATK523, DEF727, SPD96  
- **サフェル** (量子/虚無/★5): HP931, ATK640, DEF509, SPD106

## 現在の実装状況

### 完了済み基盤機能

#### 開発環境
- [x] **React開発サーバー構築**
- [x] **VSCode統合ターミナル環境**
- [x] **GitHub連携完了**（リポジトリ作成、Git管理）
- [x] **GitHub Pages設定準備**（`gh-pages`パッケージインストール済み）
- [x] **Claudeディレクトリアクセス設定**（直接コード編集可能）

#### アーキテクチャ
- [x] **メニューシステム**: 左サイドメニューでモード切り替え
- [x] **コンポーネント分割完了**
  - MainMenu - アプリケーション全体のナビゲーション
  - CharacterLibrary - キャラクター情報閲覧
  - BattleSimulator - 戦闘シミュレーション
  - XinleiSimulator - 新蕾システム専用デモ
- [x] **戦闘システム基盤**
  - UltimateSystemManager - 必殺技システム統合管理
  - BattleEventSystem - イベント駆動処理
  - XinleiSystem - キャストリス新蕾システム
  - BattleState - 戦闘状態管理
- [x] **データ構造設計**（個別キャラクターファイル分割）
- [x] **CSSアーキテクチャ整理**（components/CSS/フォルダ構造）

#### 実装済みキャラクター
- [x] **ホタル** - 超撃破アタッカー（炎/壊滅/★5）
- [x] **キャストリス** - HP依存召喚アタッカー（量子/記憶/★5）**新蕾システム対応完了**
- [x] **黄泉** - 虚無デバフアタッカー（雷/虚無/★5）
- [x] **ヒアンシー** - 記憶の精霊ヒーラー（風/記憶/★5）
- [x] **トリビー** - 汎用調和サポーター（量子/調和/★5）
- [x] **サフェル** - ダメージ記録デバッファー（量子/虚無/★5）

#### UI/UX
- [x] **ダークテーマデザイン**
- [x] **優先度別色分けシステム**（高:赤/中:オレンジ/低:緑）
- [x] **ホバーアニメーション**
- [x] **レスポンシブレイアウト**
- [x] **新蕾ゲージUI** - リアルタイム表示、モード切り替え対応

### 🆕 キャストリス新蕾システム詳細実装

#### システム仕様
```javascript
// 新蕾システムの核心仕様
- 味方HP減少 → 新蕾チャージ（1:1変換）
- 新蕾上限: 34,000（レベル80時）
- 死竜存在時: 新蕾チャージ → 死竜HP回復に切り替え
- 秘技使用: 戦闘開始時に新蕾30%獲得
- 必殺技: 新蕾100%で死竜召喚
```

#### 技術的特徴
- **プラグイン型設計**: 新システム追加時に既存コードを変更しない
- **イベント駆動**: HP変化→自動新蕾チャージ→UI即時反映
- **状態管理分離**: ビジネスロジックとUI表示の完全分離
- **デバッグ機能**: リアルタイムログ、システム統計、イベント履歴

#### デモンストレーション機能
- リアルタイム新蕾ゲージ表示
- HPダメージシミュレート（-500HP, -1000HP）
- 死竜召喚・状態管理
- モード切り替え表示（新蕾チャージ/死竜HP回復）
- アクションログ（タイムスタンプ付き）

### 解決済み技術課題
- [x] **CSSファイル文字化け問題**（UTF-8エンコーディング修正）
- [x] **コンポーネント分割時のスタイル適用**
- [x] **Git連携とフォルダ構造**最適化
- [x] **npm start頻繁再起動問題**（ホットリロード対応確認）
- [x] **特殊システム実装の設計方針**（プラグイン型アーキテクチャ採用）

## 設計思想決定事項

### データベース検討結果
**PostgreSQL + Prisma案を却下**
- 理由：開発規模に対して過剰エンジニアリング
- キャラクター20体程度の規模でDB導入は不適切
- シミュレーション機能にはメモリ内オブジェクトの方が適している
- 現在の構造で十分な拡張性を確保

### 確定アーキテクチャ
- **JavaScriptオブジェクト形式維持**
- **TypeScript段階的導入**
- **プラグイン型戦闘システム**（新設計）
- **イベント駆動計算エンジン**（utils/systems/）
- **ローカルストレージ活用**

## 機能拡張計画

### Phase 1: 戦闘システム完成度向上（次回優先）
- [ ] **黄泉の残夢システム実装**
  - デバフ付与→残夢スタック
  - 虚無キャラ攻撃→残夢スタック
  - 9スタック→必殺技発動
- [ ] **他キャラクターのEPシステム実装**
  - 標準EPシステムの詳細実装
  - EP獲得タイミング（攻撃/被攻撃/スキル使用）
- [ ] **チーム編成UI実装**
  - ドラッグ&ドロップでキャラクター選択
  - 光円錐・遺物の詳細設定
  - 星魂設定

### Phase 2: フル戦闘シミュレーション（中期目標）

#### 想定UI仕様
1. **編成設定画面**：4体キャラクター選択（ドラッグ&ドロップ対応）
2. **敵設定画面**：敵HP・防御力・属性耐性の設定
3. **シミュレーション実行**：ターン制戦闘の自動計算
4. **結果表示**：キャラクター別ダメージをグラフ・テキスト出力

#### 技術要件
```javascript
// シミュレーション状態管理構造（完成）
const simulationState = {
  team: [
    { 
      character: 'castorice', 
      eidolon: 0, 
      lightCone: { id: 'eternal_farewell', level: 80 },
      relics: { /* 遺物設定 */ },
      ultimateSystem: { type: 'xinlei', currentValue: 0, maxValue: 34000 }
    }
    // 他3体
  ],
  enemies: [{ /* 敵データ */ }],
  spirits: [{ /* 召喚物データ */ }],
  results: { /* 計算結果 */ }
};
```

### Phase 3: 高度機能
- [ ] **複数ビルド保存・比較**
- [ ] **最適装備自動提案**
- [ ] **チーム相性分析**
- [ ] **敵データベース**（忘却の庭、虚構叙事、末日の幻影）

## ファイル構成（現在）

```
hsr-character-manager/
├── public/
├── src/
│   ├── components/
│   │   ├── MainMenu.js                    # 🆕 左サイドメニュー
│   │   ├── CharacterLibrary.js           # 🆕 キャラクター図鑑
│   │   ├── BattleSimulator.js             # 🆕 戦闘シミュレーション
│   │   ├── BattleSimulator/
│   │   │   ├── XinleiSimulator.js         # 🆕 新蕾システムデモ
│   │   │   └── CSS/
│   │   │       └── XinleiSimulator.css   # 🆕 専用スタイル
│   │   ├── CharacterSelector.js          # 既存（移行済み）
│   │   ├── StatsDisplay.js               # 既存（移行済み）
│   │   ├── EquipmentDisplay.js           # 既存（移行済み）
│   │   ├── TeamComposition.js            # 既存（移行済み）
│   │   └── CSS/                          # 各コンポーネント専用CSS
│   ├── utils/                            # 🆕 戦闘システム基盤
│   │   └── systems/
│   │       ├── UltimateSystemManager.js  # 🆕 必殺技システム統合管理
│   │       ├── BattleEventSystem.js      # 🆕 イベント駆動システム
│   │       ├── XinleiSystem.js           # 🆕 キャストリス新蕾システム
│   │       └── BattleState.js            # 🆕 戦闘状態管理
│   ├── data/
│   │   └── characters/
│   │       ├── firefly.js                # ホタル
│   │       ├── castorice.js              # 🔄 キャストリス（新蕾システム対応）
│   │       ├── acheron.js                # 黄泉
│   │       ├── hyacine.js                # 🆕 ヒアンシー
│   │       ├── tribbie.js                # 🆕 トリビー
│   │       ├── cipher.js                 # 🆕 サフェル
│   │       └── index.js                  # 🔄 統合エクスポート
│   ├── hooks/                            # 将来のカスタムフック用
│   ├── App.js                            # 🔄 メニューシステム統合
│   ├── App.css                           # 🔄 新レイアウト対応
│   └── index.js
├── package.json
└── README.md
```

## 開発ワークフロー

### 日常開発
```bash
npm start  # http://localhost:3000 で開発サーバー起動
# 左メニュー「戦闘シミュレーション」→「🐉 新蕾デモ」でシステム確認
```

### GitHub Pages公開
```bash
npm run build   # 本番ビルド
npm run deploy  # GitHub Pagesに公開
```

### Claude連携
- **ディレクトリアクセス**：C:\Users\yuya\hsr-character-manager
- **リアルタイムファイル編集**可能
- **コード確認・修正**支援
- **アーキテクチャ設計**・拡張方針の提案

## 次回作業優先順位

### 🔥 高優先度（次回セッション推奨）
1. **黄泉の残夢システム実装**
   - CanmengSystem.js作成
   - デバフ付与・虚無攻撃イベント対応
   - 残夢スタックUI表示
2. **標準EPシステム詳細実装**
   - EP獲得タイミング設定
   - 通常攻撃・スキル・必殺技のEP計算
3. **チーム編成UI基盤**
   - キャラクター選択画面
   - 装備設定インターフェース

### 🔸 中優先度
4. **TypeScript移行開始**（段階的）
5. **戦闘計算エンジン拡張**
6. **新キャラクター追加**（飛霄、サンデー等）

### 🔹 低優先度
7. **敵データベース構築**
8. **結果分析・グラフ表示**
9. **パフォーマンス最適化**

## 技術的考慮事項

### 崩壊スターレイル固有仕様
- **最大レベル**: 80（原神の90と間違えないよう注意）
- **ガチャシステム**: 90連天井（キャラ）、80連天井（光円錐）
- **星魂システム**: 0～6星魂
- **新蕾上限**: 34,000（レベル80時、キャストリス専用）

### データ精度
- **HoYoWiki**: 最も信頼できる情報源として確定
- **基礎ステータス**: 装備・光円錐なしのLv80昇格完了状態
- **スキル倍率**: 公式データまたは有志検証データを使用
- **特殊システム**: 実ゲームでの動作検証済み

### パフォーマンス考慮
- **メモリ内計算**: シミュレーション処理に最適
- **イベント駆動**: 効率的な状態更新
- **プラグイン型**: 不要なシステムの計算回避
- **レスポンシブ対応**: モバイルデバイス考慮

## アーキテクチャの強み

### 🔌 プラグイン型設計
```javascript
// 新システム追加が極めて簡単
this.ultimateManager.registerSystem('new_type', new NewSystem());
```

### 📡 イベント駆動
```javascript
// HP変化 → 自動で新蕾チャージ → UI即時更新
battleState.changeHP('castorice', -500) 
// ↓ 自動でXinleiSystemが反応
// ↓ 新蕾+500、UI更新
```

### 🎯 疎結合設計
- システム間の独立性確保
- テスト・デバッグの容易さ
- 将来の機能拡張への対応

## 開発方針

### 段階的拡張
個人使用から始まり、将来的なVPS移行を視野に入れた設計。現在の構造を破綻させずに機能追加を継続。

### 実用性重視
ゲームプレイ中の実際の使用を想定し、情報アクセスの効率性を最優先。

### 保守性確保
新キャラクター・新システム追加が容易な構造を維持。コードの可読性と拡張性のバランス。

### 将来のビジョン
- **全キャラクター対応**: 特殊システム完全実装
- **敵データベース**: 全コンテンツ対応
- **最適化提案**: AI支援による編成提案
- **コミュニティ機能**: ビルド共有・比較

---

**最終更新**: 2025年9月11日  
**現在フェーズ**: Phase 1（戦闘システム基盤完成）→ Phase 2（フル機能実装）  
**次回作業**: 黄泉の残夢システム実装 + チーム編成UI  
**技術的達成**: プラグイン型戦闘システム・新蕾システム完全実装